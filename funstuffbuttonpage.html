<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caleb's Corner</title>
  <style>
    :root{
      --neon1:#00ffcc;
      --neon2:#ff00ff;
      --neon3:#ffff00;
      --bg:#060014;
      --panel:#0b0430cc;
    }

    /* Hard retro defaults */
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: "Comic Sans MS","Comic Sans", "Trebuchet MS", Arial, sans-serif;
      background: radial-gradient(circle at 20% 10%, #2b0077 0%, var(--bg) 45%, #02000a 100%);
      overflow-x:hidden;
      color:#fff;
      cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'><text y='22' font-size='22'>üìé</text></svg>") 0 24, auto;
    }

    /* Layers */
    .bg, .bg canvas, .bg .scanlines, .bg .tiler, .bg .marqueeLayer, .bg .sparkLayer{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-10;
    }

    /* Fake tiled "classic web" vibe: colored checker */
    .tiler{
      background:
        linear-gradient(45deg, rgba(255,0,255,.10) 25%, transparent 25%) -18px 0/36px 36px,
        linear-gradient(-45deg, rgba(0,255,204,.10) 25%, transparent 25%) -18px 0/36px 36px,
        linear-gradient(45deg, transparent 75%, rgba(255,255,0,.10) 75%) -18px 0/36px 36px,
        linear-gradient(-45deg, transparent 75%, rgba(255,128,0,.10) 75%) -18px 0/36px 36px;
      mix-blend-mode: normal;
      filter: saturate(140%);
      animation: drift 12s linear infinite;
      opacity:.35;
    }
    @keyframes drift{
      from { transform: translate3d(0,0,0); }
      to   { transform: translate3d(-72px,72px,0); }
    }

    /* Scanlines */
    .scanlines{
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.05),
        rgba(255,255,255,0.05) 1px,
        rgba(0,0,0,0) 3px,
        rgba(0,0,0,0) 6px
      );
      opacity:.24;
      mix-blend-mode: normal;
    }

    /* Marquee-style text bands */
    .marqueeLayer{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding-top:10px;
      opacity:.75;
    }
    .marq{
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
      text-shadow: 0 0 8px rgba(255,255,255,.25), 0 0 18px rgba(255,0,255,.25);
      white-space:nowrap;
      overflow:hidden;
      border-top:2px dashed rgba(255,255,255,.25);
      border-bottom:2px dashed rgba(255,255,255,.15);
      background: linear-gradient(90deg, rgba(255,0,255,.08), rgba(0,255,204,.08), rgba(255,255,0,.08));
      padding:6px 0;
    }
    .marq span{
      display:inline-block;
      padding-left:100%;
      animation: scroll 14s linear infinite;
    }
    .marq:nth-child(2) span{ animation-duration: 18s; }
    .marq:nth-child(3) span{ animation-duration: 22s; }
    @keyframes scroll{
      from{ transform: translateX(0); }
      to  { transform: translateX(-100%); }
    }

    /* Sparkles layer (DOM elements created by JS) */
    .sparkLayer { z-index:-8; }

    /* Main layout */
    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:32px 16px 56px;
    }
    .panel{
      width:min(860px, 95vw);
      background: var(--panel);
      border: 4px ridge rgba(255,255,255,.65);
      box-shadow:
        0 0 0 6px rgba(255,0,255,.15),
        0 0 40px rgba(0,255,204,.22),
        0 0 90px rgba(255,0,255,.12);
      border-radius: 18px;
      padding: 18px 18px 22px;
      position:relative;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      background: rgba(0,0,0,.35);
      border:2px outset rgba(255,255,255,.35);
      border-radius: 14px;
    }
    .logo .badge{
      font-size:28px;
      filter: drop-shadow(0 0 8px rgba(255,255,255,.35));
    }
    .logo h1{
      margin:0;
      font-size: clamp(22px, 3.4vw, 34px);
      line-height:1.1;
      background: linear-gradient(90deg, var(--neon2), var(--neon1), var(--neon3));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow: 0 0 16px rgba(255,255,255,.18);
    }

    .status{
      font-size:12px;
      opacity:.9;
      background: rgba(0,0,0,.35);
      border:2px inset rgba(255,255,255,.25);
      padding:10px 12px;
      border-radius: 12px;
      min-width: 230px;
    }
    .status b{ color: var(--neon1); }

    .divider{
      margin:14px 0 16px;
      height:10px;
      border-radius:999px;
      background: linear-gradient(90deg, transparent, rgba(255,0,255,.7), rgba(0,255,204,.7), rgba(255,255,0,.6), transparent);
      filter: blur(.2px);
      opacity:.85;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      background: rgba(0,0,0,.35);
      border: 3px groove rgba(255,255,255,.35);
      border-radius: 16px;
      padding: 14px;
      position:relative;
      overflow:hidden;
    }

    .card:before{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(circle at 20% 10%, rgba(255,0,255,.14), transparent 55%),
                  radial-gradient(circle at 85% 70%, rgba(0,255,204,.14), transparent 60%);
      transform: rotate(7deg);
      pointer-events:none;
    }

    .card h2{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:.5px;
      text-shadow: 0 0 10px rgba(255,255,255,.15);
    }

    .btns{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      position:relative;
      z-index:1;
    }

    /* Classic chunky buttons */
    .retro-btn{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      text-decoration:none;
      color:#fff;
      padding:12px 14px;
      border-radius: 14px;
      border: 3px outset rgba(255,255,255,.45);
      background:
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.25)),
        linear-gradient(90deg, rgba(255,0,255,.45), rgba(0,255,204,.35), rgba(255,255,0,.28));
      box-shadow:
        0 10px 18px rgba(0,0,0,.35),
        0 0 0 5px rgba(255,0,255,.12),
        0 0 22px rgba(0,255,204,.12);
      transform: translateZ(0);
      transition: transform .08s ease, filter .12s ease;
      position:relative;
      overflow:hidden;
    }

    .retro-btn .left{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.6px;
      text-transform:uppercase;
    }

    .retro-btn .icon{
      width:34px;height:34px;
      display:grid;place-items:center;
      background: rgba(0,0,0,.35);
      border:2px inset rgba(255,255,255,.22);
      border-radius: 10px;
      font-size:18px;
      filter: drop-shadow(0 0 8px rgba(255,255,255,.20));
    }

    .retro-btn .go{
      font-size:12px;
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.22);
      opacity:.95;
    }

    .retro-btn:after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.16) 20%, transparent 40%);
      transform: translateX(-120%);
      animation: shine 2.6s linear infinite;
      pointer-events:none;
    }
    @keyframes shine{
      to{ transform: translateX(120%); }
    }

    .retro-btn:hover{
      transform: translateY(-2px) scale(1.01);
      filter: saturate(120%) brightness(1.05);
    }
    .retro-btn:active{
      transform: translateY(1px) scale(.995);
      border-style: inset;
    }

    /* Right side: classic "guestbook / stats" vibe */
    .tiny{
      font-size: 12px;
      line-height: 1.45;
      opacity:.95;
      position:relative;
      z-index:1;
    }
    .tiny .pill{
      display:inline-block;
      margin: 0 6px 6px 0;
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.45);
      border:1px dashed rgba(255,255,255,.25);
      box-shadow: 0 0 18px rgba(255,0,255,.10);
    }

    .footer{
      margin-top:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      opacity:.9;
    }
    .blink{
      animation: blink 1.1s steps(2, jump-none) infinite;
      color: var(--neon3);
      text-shadow: 0 0 10px rgba(255,255,0,.25);
      font-weight:900;
    }
    @keyframes blink{
      50%{ opacity:.2; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .tiler, .marq span, .retro-btn:after, .blink { animation: none !important; }
    }
    /* ---- Weather module (more impressive) ---- */
    .wxbox{
    margin-top: 10px;
    padding: 12px;
    border-radius: 16px;
    border: 3px groove rgba(255,255,255,.35);
    background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.25)),
        radial-gradient(circle at 20% 10%, rgba(0,255,204,.18), transparent 55%),
        radial-gradient(circle at 90% 80%, rgba(255,0,255,.18), transparent 60%),
        rgba(0,0,0,.38);
    box-shadow:
        0 0 0 6px rgba(0,255,204,.06),
        0 0 30px rgba(255,0,255,.12),
        inset 0 0 18px rgba(0,255,204,.08);
    position:relative;
    overflow:hidden;
    }

    .wxbox:before{
    content:"";
    position:absolute;
    inset:-60px;
    background: conic-gradient(from 90deg, transparent 0 70%, rgba(255,255,255,.16) 78%, transparent 86%);
    animation: wxsweep 3.2s linear infinite;
    opacity:.35;
    pointer-events:none;
    }
    @keyframes wxsweep{
    to{ transform: rotate(360deg); }
    }

    .wxTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    position:relative;
    z-index:1;
    }

    .wxTitle{
    font-weight: 900;
    letter-spacing: .7px;
    text-transform: uppercase;
    text-shadow: 0 0 10px rgba(255,255,255,.14);
    font-size: 13px;
    }

    .wxStatus{
    font-size: 12px;
    opacity:.95;
    background: rgba(0,0,0,.45);
    border: 2px inset rgba(255,255,255,.20);
    padding: 6px 10px;
    border-radius: 999px;
    }

    .wxMain{
    display:flex;
    align-items:center;
    gap:12px;
    margin-top:10px;
    position:relative;
    z-index:1;
    }

    .wxIcon{
    width: 52px;
    height: 52px;
    display:grid;
    place-items:center;
    border-radius: 16px;
    border: 2px inset rgba(255,255,255,.22);
    background: rgba(0,0,0,.38);
    font-size: 26px;
    filter: drop-shadow(0 0 10px rgba(255,255,255,.18));
    }

    .wxBig{
    font-weight:900;
    font-size: 18px;
    line-height:1.1;
    text-shadow: 0 0 12px rgba(255,255,255,.14);
    }

    .wxMeta{
    font-size: 12px;
    opacity:.92;
    margin-top:4px;
    }

    .wxGrid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:8px;
    margin-top:10px;
    position:relative;
    z-index:1;
    }

    .wxStat{
    background: rgba(0,0,0,.40);
    border: 1px dashed rgba(255,255,255,.25);
    border-radius: 14px;
    padding: 8px 10px;
    box-shadow: 0 0 16px rgba(0,255,204,.06);
    }
    .wxStat b{
    color: var(--neon1);
    font-weight:900;
    }

    .wxStrip{
    display:flex;
    gap:8px;
    overflow:auto;
    margin-top:10px;
    padding-bottom:4px;
    position:relative;
    z-index:1;
    }
    .wxChip{
    flex: 0 0 auto;
    min-width: 92px;
    padding: 8px 10px;
    border-radius: 14px;
    background: rgba(0,0,0,.40);
    border: 2px outset rgba(255,255,255,.20);
    font-size: 12px;
    text-align:center;
    white-space:nowrap;
    }
    .wxChip .t{ font-weight:900; color: var(--neon3); }
    .wxChip .s{ opacity:.92; margin-top:2px; display:block; }

    .wxHint{
    margin-top:8px;
    font-size: 11px;
    opacity:.9;
    position:relative;
    z-index:1;
    }

    .wxBtn{
    margin-top:10px;
    width:100%;
    cursor:pointer;
    font-family:inherit;
    font-weight:900;
    padding:10px 12px;
    border-radius:12px;
    border:3px outset rgba(255,255,255,.45);
    background: rgba(0,0,0,.35);
    color:#fff;
    }
    .wxBtn:active{ border-style: inset; }

    /* ---- Onion RSS module ---- */
    .newsbox{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 3px groove rgba(255,255,255,.35);
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.25)),
        radial-gradient(circle at 20% 10%, rgba(255,255,0,.14), transparent 55%),
        radial-gradient(circle at 90% 80%, rgba(255,0,255,.14), transparent 60%),
        rgba(0,0,0,.38);
      box-shadow:
        0 0 0 6px rgba(255,255,0,.05),
        0 0 30px rgba(255,0,255,.10),
        inset 0 0 18px rgba(255,255,0,.06);
      position:relative;
      overflow:hidden;
    }
    .newsTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .newsTitle{
      font-weight: 900;
      letter-spacing: .7px;
      text-transform: uppercase;
      text-shadow: 0 0 10px rgba(255,255,255,.14);
      font-size: 13px;
    }
    .newsStatus{
      font-size: 12px;
      opacity:.95;
      background: rgba(0,0,0,.45);
      border: 2px inset rgba(255,255,255,.20);
      padding: 6px 10px;
      border-radius: 999px;
    }
    .newsList{
      margin: 10px 0 0;
      padding: 0;
      list-style: none;
    }
    .newsItem{
      display:block;
      padding: 10px 10px;
      margin-top: 8px;
      border-radius: 14px;
      background: rgba(0,0,0,.40);
      border: 1px dashed rgba(255,255,255,.25);
    }
    .newsItem a{
      color:#fff;
      text-decoration:none;
      font-weight:900;
      letter-spacing:.2px;
    }
    .newsItem a:hover{ text-decoration: underline; }
    .newsMeta{
      margin-top: 4px;
      font-size: 11px;
      opacity:.85;
    }
    .newsBtn{
      margin-top:10px;
      width:100%;
      cursor:pointer;
      font-family:inherit;
      font-weight:900;
      padding:10px 12px;
      border-radius:12px;
      border:3px outset rgba(255,255,255,.45);
      background: rgba(0,0,0,.35);
      color:#fff;
    }
    .newsBtn:active{ border-style: inset; }

  </style>
</head>

<body>
  <div class="bg" aria-hidden="true">
    <canvas id="stars"></canvas>
    <div class="tiler"></div>
    <div class="scanlines"></div>

    <div class="marqueeLayer">
      <div class="marq"><span>ü§ñ WELCOME TO THE INTERNET ‚Ä¢ WELCOME TO THE INTERNET ‚Ä¢ WELCOME TO THE INTERNET ‚Ä¢ ü§ñ ‚Ä¢ </span></div>
      <div class="marq"><span>UNDER CONSTRUCTION ‚Ä¢ BEST VIEWED WITH YOUR EYEBALLS </span></div>
      <div class="marq"><span>NEON MODE ENGAGED ‚Ä¢ SPARKLES INBOUND ‚Ä¢ HAVE A RAD DAY ‚Ä¢ üòé ‚Ä¢ </span></div>
    </div>

    <div class="sparkLayer" id="sparks"></div>
  </div>

  <main class="wrap">
    <section class="panel">
      <div class="header">
        <div class="logo">
          <div class="badge">üòé</div>
          <div>
            <h1>Caleb's Classic Web HQ</h1>
            <div style="font-size:12px; opacity:.9;">totally legit ‚Ä¢ 100% fire ‚Ä¢ completely rad</div>
          </div>
        </div>

        <div class="status">
          <div><b>Status:</b> Vibing at maximum nostalgia</div>
          <div><b>Graphics:</b> Starfield + sparkles + scanlines</div>
          <div><b>Security:</b> 100% unhackable vibes</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid">
        <div class="card">
          <h2>üöÄFun Simulators</h2>
          <div class="btns" id="buttonList">
            <!-- PLACEHOLDERS: edit label + href later -->
            <a class="retro-btn" href="https://jonescaleb1212.github.io/galaga.html">
              <span class="left"><span class="icon">üïπÔ∏è</span><span class="label">Galaga (kinda)</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>
            <a class="retro-btn" href="https://jonescaleb1212.github.io/games/madelbrot.html">
              <span class="left"><span class="icon">üêá</span><span class="label">Mandelbrot Flow</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>
                        <a class="retro-btn" href="https://jonescaleb1212.github.io/games/aud2vis_v4.html">
              <span class="left"><span class="icon">ü™©</span><span class="label">Audio Visualizer</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>
            <a class="retro-btn" href="https://jonescaleb1212.github.io/games/lorenz.html">
              <span class="left"><span class="icon">‚öôÔ∏è</span><span class="label">Lorenz Attractor</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>
            <a class="retro-btn" href="https://jonescaleb1212.github.io/games/boids.html">
              <span class="left"><span class="icon">üê¶</span><span class="label">Boids</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>

            <a class="retro-btn" href="https://jonescaleb1212.github.io/games/life.html">
              <span class="left"><span class="icon">ü¶†</span><span class="label">Life</span></span>
              <span class="go">GO ‚ñ∂</span>
            </a>
          </div>
        </div>

        <div class="card">
          <h2>üìº Happenings</h2>
          <div class="tiny">
            <div class="pill">Visitor count: <span id="visits">000001</span></div>
            <div class="pill">Page hits: <span id="hits">0001337</span></div>
            <div class="wxbox" id="wxBox">
            <div class="wxTop">
                <div class="wxTitle">üå¶Ô∏è Weather Terminal</div>
                <div class="wxStatus" id="wxStatus">IDLE</div>
            </div>

            <div class="wxMain">
                <div class="wxIcon" id="wxIcon">üîß</div>
                <div>
                <div class="wxBig" id="wxBig">Local forecast: ‚Äî</div>
                <div class="wxMeta" id="wxMeta">Click enable to fetch your forecast (uses browser location).</div>
                </div>
            </div>

            <div class="wxGrid">
                <div class="wxStat"><b>Temp</b>: <span id="wxTemp">‚Äî</span></div>
                <div class="wxStat"><b>Wind</b>: <span id="wxWind">‚Äî</span></div>
                <div class="wxStat"><b>Precip</b>: <span id="wxPrecip">‚Äî</span></div>
            </div>

            <div class="wxStrip" id="wxStrip" aria-label="Next days forecast"></div>

            <div class="wxHint" id="wxHint">Tip: GitHub Pages is HTTPS, so location works. If you deny it, weather stays offline.</div>

            <button class="wxBtn" id="wxBtn">Enable Local Forecast ‚õÖ</button>
            </div>

            <!-- üßÖ Onion Wire panel -->
            <div class="newsbox" id="newsBox">
              <div class="newsTop">
                <div class="newsTitle">üßÖBREAKING TRUE NEWS</div>
                <div class="newsStatus" id="newsStatus">IDLE</div>
              </div>

              <ul class="newsList" id="newsList" aria-label="Latest Onion headlines"></ul>

              <button class="newsBtn" id="newsBtn">Refresh Onion Headlines üßÖ</button>
            </div>

            </div>

            <hr style="border:none;border-top:2px dotted rgba(255,255,255,.25); margin:10px 0;">

            <div class="blink">‚òÖ NEW: Click anywhere for sparkles ‚òÖ</div>
            <p style="margin:10px 0 0;">

            </p>
          </div>
        </div>
      </div>

      <div class="footer">
        <div>¬© <span id="year"></span> My Web HQ ‚Ä¢ Made with excessive vibes</div>
        <div><span class="blink">UNDER CONSTRUCTION</span> ‚õèÔ∏è</div>
      </div>
    </section>
  </main>

  <script>
    // ---- Retro counters (fake but fun; persisted in localStorage)
    const pad = (n, w=6) => String(n).padStart(w, "0");
    const visitsKey = "retro_visits";
    const hitsKey = "retro_hits";

    const visits = (Number(localStorage.getItem(visitsKey)) || 0) + 1;
    const hits = (Number(localStorage.getItem(hitsKey)) || 1337) + Math.floor(Math.random()*7) + 1;

    localStorage.setItem(visitsKey, visits);
    localStorage.setItem(hitsKey, hits);

    document.getElementById("visits").textContent = pad(visits);
    document.getElementById("hits").textContent = pad(hits);
    document.getElementById("year").textContent = new Date().getFullYear();

    // ---- Starfield background (canvas)
    const canvas = document.getElementById("stars");
    const ctx = canvas.getContext("2d", { alpha: true });

    let W, H, DPR;
    function resize(){
      DPR = Math.min(2, window.devicePixelRatio || 1);
      W = canvas.width  = Math.floor(innerWidth  * DPR);
      H = canvas.height = Math.floor(innerHeight * DPR);
      canvas.style.width  = innerWidth + "px";
      canvas.style.height = innerHeight + "px";
    }
    window.addEventListener("resize", resize);
    resize();

    const starCount = Math.floor(Math.min(900, Math.max(240, innerWidth * innerHeight / 6000)));
    const stars = Array.from({length: starCount}, () => ({
      x: Math.random()*W,
      y: Math.random()*H,
      z: Math.random()*1 + 0.2,
      r: Math.random()*1.4 + 0.2,
      tw: Math.random()*Math.PI*2
    }));

    let t0 = performance.now();
    let lastFrame = 0;

    const FPS = 20;                 // ‚≠ê change to 20 for even more savings
    const FRAME_MS = 1000 / FPS;

    function tick(t){
      if (t - lastFrame < FRAME_MS){
        requestAnimationFrame(tick);
        return;
      }
      lastFrame = t;

      const dt = Math.min(0.05, (t - t0) / 1000);
      t0 = t;

      ctx.clearRect(0,0,W,H);

      // subtle vignette glow
      const g = ctx.createRadialGradient(
        W*0.5, H*0.4, 10,
        W*0.5, H*0.5, Math.max(W,H)*0.65
      );
      g.addColorStop(0, "rgba(255,0,255,0.08)");
      g.addColorStop(0.5, "rgba(0,255,204,0.05)");
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      // stars
      for (const s of stars){
        s.y += (35 * s.z) * DPR * dt;
        s.x += Math.sin(t*0.0003 + s.tw) * 7 * DPR * dt;
        if (s.y > H + 10) { s.y = -10; s.x = Math.random()*W; }

        const twinkle = 0.55 + 0.45*Math.sin(t*0.004 + s.tw);
        ctx.globalAlpha = 0.25 + twinkle*0.7;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r*DPR*(0.6 + twinkle), 0, Math.PI*2);
        ctx.fillStyle = "white";
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);


    // ---- Sparkles on click / move (DOM, cheap & cheerful)
    const sparks = document.getElementById("sparks");
    const emojis = ["‚ú®","üí´","‚≠ê","üåü","‚ö°","üòé"];
    function spawnSpark(x,y){
      const s = document.createElement("div");
      s.textContent = emojis[(Math.random()*emojis.length)|0];
      s.style.position = "absolute";
      s.style.left = (x + (Math.random()*14-7)) + "px";
      s.style.top  = (y + (Math.random()*14-7)) + "px";
      s.style.fontSize = (12 + Math.random()*22) + "px";
      s.style.filter = "drop-shadow(0 0 8px rgba(255,255,255,.3))";
      s.style.transform = `translate(-50%,-50%) rotate(${Math.random()*40-20}deg)`;
      s.style.opacity = "1";
      s.style.transition = "transform 700ms ease, opacity 700ms ease";
      sparks.appendChild(s);

      // animate
      requestAnimationFrame(() => {
        const dx = (Math.random()*120 - 60);
        const dy = (Math.random()*140 - 40);
        s.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) rotate(${Math.random()*240-120}deg)`;
        s.style.opacity = "0";
      });

      setTimeout(() => s.remove(), 800);
    }
    // ---- Weather module (daily panels) ----
    function wxCodeToText(code) {
    const map = {
        0: "Clear",
        1: "Mostly clear",
        2: "Partly cloudy",
        3: "Overcast",
        45: "Fog",
        48: "Rime fog",
        51: "Light drizzle",
        53: "Drizzle",
        55: "Heavy drizzle",
        61: "Light rain",
        63: "Rain",
        65: "Heavy rain",
        71: "Light snow",
        73: "Snow",
        75: "Heavy snow",
        80: "Showers",
        95: "Thunderstorm"
    };
    return map[code] ?? `Weather (${code})`;
    }

    function wxCodeToIcon(code) {
    if (code === 0) return "‚òÄÔ∏è";
    if (code <= 2) return "üå§Ô∏è";
    if (code === 3) return "‚òÅÔ∏è";
    if (code === 45 || code === 48) return "üå´Ô∏è";
    if (code >= 51 && code <= 55) return "üå¶Ô∏è";
    if (code >= 61 && code <= 65) return "üåßÔ∏è";
    if (code >= 71 && code <= 75) return "üå®Ô∏è";
    if (code === 80) return "üåßÔ∏è";
    if (code === 95) return "‚õàÔ∏è";
    return "üòé";
    }

    async function fetchOpenMeteo(lat, lon) {
    const url =
        "https://api.open-meteo.com/v1/forecast" +
        `?latitude=${encodeURIComponent(lat)}` +
        `&longitude=${encodeURIComponent(lon)}` +
        "&current=temperature_2m,weather_code,wind_speed_10m" +
        "&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,wind_speed_10m_max" +
        "&temperature_unit=fahrenheit" +
        "&wind_speed_unit=mph" +
        "&timezone=auto";

    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error("Weather fetch failed");
    return res.json();
    }

    function setWxStatus(text) {
    const el = document.getElementById("wxStatus");
    if (el) el.textContent = text;
    }

    function clearWxStrip() {
    const strip = document.getElementById("wxStrip");
    if (strip) strip.innerHTML = "";
    }

    async function renderWeatherFromCoords(lat, lon) {
    const wxBig = document.getElementById("wxBig");
    const wxMeta = document.getElementById("wxMeta");
    const wxIcon = document.getElementById("wxIcon");
    const wxTemp = document.getElementById("wxTemp");
    const wxWind = document.getElementById("wxWind");
    const wxPrecip = document.getElementById("wxPrecip");
    const btn = document.getElementById("wxBtn");
    const strip = document.getElementById("wxStrip");

    setWxStatus("CONNECTING");
    if (btn) btn.textContent = "Refreshing‚Ä¶";
    if (wxMeta) wxMeta.textContent = `Coords: ${lat.toFixed(2)}, ${lon.toFixed(2)} ‚Ä¢ fetching forecast‚Ä¶`;
    clearWxStrip();

    const data = await fetchOpenMeteo(lat, lon);

    const cur = data.current;
    const desc = wxCodeToText(cur.weather_code);
    const icon = wxCodeToIcon(cur.weather_code);
    const temp = Math.round(cur.temperature_2m);

    let precip = "‚Äî";
    if (data.daily?.precipitation_probability_max?.length) {
        precip = `${data.daily.precipitation_probability_max[0]}% (today max)`;
    }

    let windStat = "‚Äî";
    if (data.daily?.wind_speed_10m_max?.length) {
        windStat = `${Math.round(data.daily.wind_speed_10m_max[0])} mph (today max)`;
    } else if (typeof cur.wind_speed_10m === "number") {
        windStat = `${Math.round(cur.wind_speed_10m)} mph`;
    }

    if (wxIcon) wxIcon.textContent = icon;
    if (wxBig) wxBig.textContent = `${desc}, ${temp}¬∞F `;
    if (wxTemp) wxTemp.textContent = `${temp}¬∞F`;
    if (wxWind) wxWind.textContent = windStat;
    if (wxPrecip) wxPrecip.textContent = precip;

    if (wxMeta) wxMeta.textContent = `Updated ${cur.time} ‚Ä¢ Timezone: ${data.timezone ?? "auto"}`;
    setWxStatus("LIVE");
    if (btn) btn.textContent = "Refresh Forecast ‚òÅÔ∏è";

    // Daily chips (next 5 days)
    const dTime = data.daily?.time || [];
    const dMax  = data.daily?.temperature_2m_max || [];
    const dMin  = data.daily?.temperature_2m_min || [];
    const dP    = data.daily?.precipitation_probability_max || [];
    const dCode = data.daily?.weather_code || [];
    const dWind = data.daily?.wind_speed_10m_max || [];

    const nDays = Math.min(5, dTime.length, dMax.length, dMin.length, dP.length, dCode.length, dWind.length);

    if (strip) {
        for (let i = 0; i < nDays; i++) {
        const date = new Date(dTime[i] + "T00:00:00");
        const label = date.toLocaleDateString(undefined, { weekday: "short" });
        const dayIcon = wxCodeToIcon(dCode[i]);

        const chip = document.createElement("div");
        chip.className = "wxChip";
        chip.innerHTML = `
            <div class="t">${label}</div>
            <div style="font-size:18px; margin:4px 0 2px;">${dayIcon}</div>
            <span class="s">Hi ${Math.round(dMax[i])}¬∞ ‚Ä¢ Lo ${Math.round(dMin[i])}¬∞</span>
            <span class="s">Precip ${dP[i]}% ‚Ä¢ Wind ${Math.round(dWind[i])} mph</span>
        `;
        strip.appendChild(chip);
        }
    }
    }

    function requestAndShowWeather() {
    const btn = document.getElementById("wxBtn");
    const wxMeta = document.getElementById("wxMeta");

    if (!("geolocation" in navigator)) {
        setWxStatus("NO GEO");
        if (wxMeta) wxMeta.textContent = "Geolocation not supported in this browser.";
        return;
    }

    setWxStatus("ASKING");
    if (btn) btn.textContent = "Allow location‚Ä¶";

    navigator.geolocation.getCurrentPosition(
        async (pos) => {
        try {
            const { latitude: lat, longitude: lon } = pos.coords;
            await renderWeatherFromCoords(lat, lon);
        } catch (e) {
            setWxStatus("ERROR");
            if (wxMeta) wxMeta.textContent = "Weather unavailable (fetch failed). Check console.";
            if (btn) btn.textContent = "Try Again üòµ‚Äçüí´";
            console.error(e);
        }
        },
        (err) => {
        setWxStatus("DENIED");
        if (wxMeta) wxMeta.textContent = "Location denied. Click again and allow location to show local forecast.";
        if (btn) btn.textContent = "Enable Local Forecast ‚òÅÔ∏è";
        console.warn(err);
        },
        { enableHighAccuracy: false, timeout: 8000, maximumAge: 10 * 60 * 1000 }
    );
    }

    // Wire the button (safe)
    document.getElementById("wxBtn")?.addEventListener("click", requestAndShowWeather);
    // ---- Onion RSS module (latest headlines) ----
    function setNewsStatus(text){
      const el = document.getElementById("newsStatus");
      if (el) el.textContent = text;
    }
    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      })[m]);
    }
    async function fetchOnionRSS(){
      const rssUrl = "https://www.theonion.com/rss";
      const proxies = [
        // Raw CORS proxy (best when it works)
        "https://api.allorigins.win/raw?url=" + encodeURIComponent(rssUrl),

        // JSON proxy (we‚Äôll extract contents)
        "https://api.allorigins.win/get?url=" + encodeURIComponent(rssUrl),

        // Jina reader as last resort
        "https://r.jina.ai/" + rssUrl,
      ];

      let lastErr = null;

      for (const url of proxies){
        try{
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);

          // allorigins "get" returns JSON { contents: "...xml..." }
          if (url.includes("allorigins.win/get?")){
            const j = await res.json();
            if (!j || !j.contents) throw new Error("allorigins JSON missing contents");
            return j.contents;
          }

          // raw or jina -> text
          const txt = await res.text();
          if (!txt || txt.length < 50) throw new Error("Empty/short response");
          return txt;

        } catch (e){
          console.warn("Onion fetch attempt failed:", e);
          lastErr = e;
        }
      }

      throw lastErr || new Error("All proxies failed");
    }

    function parseRSS(xmlText){
      const xml = new DOMParser().parseFromString(xmlText, "text/xml");
      const items = Array.from(xml.querySelectorAll("item"));
      return items.map(it => ({
        title: it.querySelector("title")?.textContent?.trim() || "Untitled",
        link:  it.querySelector("link")?.textContent?.trim()  || "#",
        pub:   it.querySelector("pubDate")?.textContent?.trim() || ""
      }));
    }
    function niceDate(pubDate){
      const d = new Date(pubDate);
      if (isNaN(d.getTime())) return "";
      return d.toLocaleString(undefined, { weekday:"short", month:"short", day:"numeric", hour:"numeric", minute:"2-digit" });
    }
    async function renderOnion(){
      const list = document.getElementById("newsList");
      const btn  = document.getElementById("newsBtn");
      if (!list) return;

      setNewsStatus("LOADING");
      if (btn) btn.textContent = "Fetching‚Ä¶ üßÖ";
      list.innerHTML = `<li class="newsItem">Contacting the satire dimension‚Ä¶</li>`;

      try{
        const xmlText = await fetchOnionRSS();
        const items = parseRSS(xmlText).slice(0, 8);

        if (!items.length){
          list.innerHTML = `<li class="newsItem">No headlines found. (RSS format changed?)</li>`;
          setNewsStatus("EMPTY");
        } else {
          list.innerHTML = items.map((it) => {
            const when = niceDate(it.pub);
            return `
              <li class="newsItem">
                <a href="${escapeHTML(it.link)}" target="_blank" rel="noopener noreferrer">
                  ${escapeHTML(it.title)}
                </a>
                <div class="newsMeta">${when ? "üóìÔ∏è " + escapeHTML(when) : "üßÖ Fresh-ish."}</div>
              </li>
            `;
          }).join("");
          setNewsStatus("LIVE");
        }

        if (btn) btn.textContent = "Refresh Onion Headlines üßÖ";
      } catch (e){
        console.error(e);
        setNewsStatus("ERROR");
        list.innerHTML = `<li class="newsItem">Headline feed down: ${escapeHTML(e?.message || e)} ü´†</li>`;

        if (btn) btn.textContent = "Try Again üòµ‚Äçüí´";
      }
    }

// Wire + autoload
document.getElementById("newsBtn")?.addEventListener("click", renderOnion);
renderOnion();


    window.addEventListener("click", (e) => {
      for(let i=0;i<8;i++) spawnSpark(e.clientX, e.clientY);
    });

    // ---- Placeholder button behavior
    // Prevent "#" placeholders from scrolling to top while you're still wiring links.
    document.getElementById("buttonList").addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if (!a) return;
      const href = a.getAttribute("href") || "";
      if (href.startsWith("#LINK_")) {
        e.preventDefault();
        spawnSpark(e.clientX, e.clientY);
      }
    });
  </script>
</body>
</html>
